{"version":3,"file":"comment.min.js","sources":["../src/comment.js"],"sourcesContent":["/*\n * Change comments\n *\n * @package    block_deft\n * @module     block_deft/comment\n * @copyright  2022 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from \"core_form/modalform\";\nimport {get_string as getString} from \"core/str\";\n\nexport default {\n\n    /**\n     * Listen for comment actions\n     *\n     * @param {int} contextid Context id of block\n     * @param {string} selector Content location to replace\n     * @param {object} refresh Interface to update content\n     */\n    init: function(contextid, selector, refresh) {\n        document.querySelectorAll(selector).forEach(block => {\n            block.addEventListener('click', (e) => {\n                const button = e.target.closest('[data-type=\"comments\"] [data-action]');\n                if (button) {\n                    let modalForm;\n                    e.preventDefault();\n                    e.stopPropagation();\n                    switch (button.getAttribute('data-action')) {\n                        case 'addcomment':\n                            modalForm = new ModalForm({\n                                formClass: \"block_deft\\\\form\\\\add_comment\",\n                                args: {\n                                    contextid: contextid,\n                                    id: button.closest('[data-task]').getAttribute('data-task')\n                                },\n                                modalConfig: {\n                                    title: getString('addcomment')\n                                }\n                            });\n                            break;\n                        case 'delete':\n                            modalForm = new ModalForm({\n                                formClass: \"block_deft\\\\form\\\\delete_comment\",\n                                args: {\n                                    commentid: button.closest('[data-comment]').getAttribute('data-comment'),\n                                    contextid: contextid,\n                                    id: button.closest('[data-task]').getAttribute('data-task')\n                                },\n                                modalConfig: {\n                                    title: getString('confirm')\n                                }\n                            });\n                            break;\n                        case 'collapse':\n                            button.closest('[data-modified]').setAttribute('data-modified', 0);\n                            button.closest('[data-type]').querySelector('.block_deft_comments').classList.remove('expanded');\n                            refresh.update();\n                            return;\n                        case 'expand':\n                            button.closest('[data-modified]').setAttribute('data-modified', 0);\n                            button.closest('[data-type]').querySelector('.block_deft_comments').classList.add('expanded');\n                            refresh.update();\n                            return;\n                    }\n                    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                        document.body.dispatchEvent(new CustomEvent('deftaction', { }));\n                    });\n                    modalForm.show();\n                }\n            });\n        });\n    }\n};\n"],"names":["e","_modalform","__esModule","default","_default","init","contextid","selector","refresh","document","querySelectorAll","forEach","block","addEventListener","button","target","closest","modalForm","preventDefault","stopPropagation","getAttribute","ModalForm","formClass","args","id","modalConfig","title","getString","get_string","commentid","setAttribute","querySelector","classList","remove","update","add","events","FORM_SUBMITTED","body","dispatchEvent","CustomEvent","show","_exports"],"mappings":"4GAS4C,IAAAA;;;;;;;;qFAA5CC,YAA4CD,EAA5CC,aAA4CD,EAAAE,WAAAF,EAAAG,CAAAA,QAAAH,GAT5C,IAAAI,SAYe,CASXC,KAAM,SAASC,UAAWC,SAAUC,SAChCC,SAASC,iBAAiBH,UAAUI,QAAQC,QACxCA,MAAMC,iBAAiB,QAAUb,IAC7B,MAAMc,OAASd,EAAEe,OAAOC,QAAQ,wCAChC,GAAIF,OAAQ,CACR,IAAIG,UAGJ,OAFAjB,EAAEkB,iBACFlB,EAAEmB,kBACML,OAAOM,aAAa,gBACxB,IAAK,aACDH,UAAY,IAAII,WAAAA,QAAU,CACtBC,UAAW,gCACXC,KAAM,CACFjB,UAAWA,UACXkB,GAAIV,OAAOE,QAAQ,eAAeI,aAAa,cAEnDK,YAAa,CACTC,OAAO,EAAAC,KAASC,YAAC,iBAGzB,MACJ,IAAK,SACDX,UAAY,IAAII,WAAAA,QAAU,CACtBC,UAAW,mCACXC,KAAM,CACFM,UAAWf,OAAOE,QAAQ,kBAAkBI,aAAa,gBACzDd,UAAWA,UACXkB,GAAIV,OAAOE,QAAQ,eAAeI,aAAa,cAEnDK,YAAa,CACTC,OAAO,EAAAC,KAASC,YAAC,cAGzB,MACJ,IAAK,WAID,OAHAd,OAAOE,QAAQ,mBAAmBc,aAAa,gBAAiB,GAChEhB,OAAOE,QAAQ,eAAee,cAAc,wBAAwBC,UAAUC,OAAO,iBACrFzB,QAAQ0B,SAEZ,IAAK,SAID,OAHApB,OAAOE,QAAQ,mBAAmBc,aAAa,gBAAiB,GAChEhB,OAAOE,QAAQ,eAAee,cAAc,wBAAwBC,UAAUG,IAAI,iBAClF3B,QAAQ0B,SAGhBjB,UAAUJ,iBAAiBI,UAAUmB,OAAOC,eAAgB,KACxD5B,SAAS6B,KAAKC,cAAc,IAAIC,YAAY,aAAc,CAAG,MAEjEvB,UAAUwB,MACd,KAGZ,GACH,OAAAC,SAAAvC,QAAAC,SAAAsC,SAAAvC,OAAA"}