{"version":3,"file":"venue.min.js","sources":["../src/venue.js"],"sourcesContent":["/*\n * Handle events for venue task\n *\n * @package    block_deft\n * @module     block_deft/venue\n * @copyright  2022 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Config from 'core/config';\nimport Fragment from 'core/fragment';\nimport {get_string as getString} from 'core/str';\nimport ModalEvents from 'core/modal_events';\nimport ModalFactory from 'core/modal_factory';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\nlet venue = null;\n\n/**\n * Handle button click\n *\n * @param {Event} e Change event\n */\nconst handleClick = (e) => {\n    'use strict';\n\n    let button = e.target.closest('.block_deft_venue button[data-action]:not([disabled])');\n    if (button) {\n        let task = button.closest('[data-task]').getAttribute('data-task'),\n            url = new URL(Config.wwwroot + '/blocks/deft/venue.php');\n        url.searchParams.set('task', task);\n        switch (button.getAttribute('data-action')) {\n            case 'close':\n                Ajax.call([{\n                    args: {\n                        mute: false,\n                        \"status\": true\n                    },\n                    fail: Notification.exception,\n                    methodname: 'block_deft_venue_settings'\n                }]);\n                break;\n            case 'join':\n                if (button.getAttribute('data-type') === 'modal') {\n                    const contextid = button.getAttribute('data-contextid');\n                    document.querySelectorAll('.venue_manager').forEach(container => {\n                        container.innerHTML = '';\n                    });\n                    ModalFactory.create({\n                        large: true,\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: getString('venue', 'block_deft'),\n                        body: '<div class=\"venue_manager\"></div>',\n                    }).then(function(modal) {\n                        const root = modal.getRoot();\n                        venue = modal;\n                        modal.setSaveButtonText(getString('hide'));\n                        modal.setButtonText('cancel', getString('leave', 'block_deft'));\n                        document.querySelector('body').classList.add('block_deft_venue_page');\n                        root.on(ModalEvents.cancel, function() {\n                            Ajax.call([{\n                                args: {\n                                    mute: false,\n                                    \"status\": true\n                                },\n                                fail: Notification.exception,\n                                methodname: 'block_deft_venue_settings'\n                            }]);\n                        });\n                        modal.show();\n\n                        return Fragment.loadFragment(\n                            'block_deft',\n                            'venue_manager',\n                            contextid,\n                            {\n                                taskid: task\n                            }\n                        );\n                    }).done((html, js) => {\n                        const root = venue.getRoot();\n                        Templates.replaceNodeContents(root[0].querySelector('.modal-content .modal-body'), html, js);\n                    }).fail(Notification.exception);\n                } else if (button.getAttribute('data-type') === 'static') {\n                    const contextid = button.getAttribute('data-contextid');\n                    Fragment.loadFragment(\n                         'block_deft',\n                         'venue_manager',\n                         contextid,\n                         {\n                             taskid: task\n                         }\n                     ).then((html, js) => {\n                          Templates.replaceNodeContents('[data-region=\"block_deft_venue_static\"]', html, js);\n                    }).fail(Notification.exception);\n                } else {\n                    document.querySelector('body').classList.remove('block_deft_venue_page');\n                    window.open(url, 'block_deft_venue', 'popup,height=400,width=600');\n                }\n                break;\n            case 'mute':\n                Ajax.call([{\n                    args: {\n                        mute: true,\n                        \"status\": false\n                    },\n                    fail: Notification.exception,\n                    methodname: 'block_deft_venue_settings'\n                }]);\n                break;\n            case 'show':\n                venue.show();\n                break;\n            case 'unmute':\n                Ajax.call([{\n                    args: {\n                        mute: false,\n                        \"status\": false\n                    },\n                    fail: Notification.exception,\n                    methodname: 'block_deft_venue_settings'\n                }]);\n                break;\n            default:\n                return;\n        }\n        e.stopPropagation();\n        e.preventDefault();\n        document.activeElement.blur();\n    }\n};\n\nconst cleanupVenue = function() {\n    if (venue) {\n        venue.destroy();\n        venue = null;\n    }\n\n    document.querySelector('body').classList.remove('block_deft_venue_page');\n};\n\n/**\n * Initialize listeners\n */\nexport const init = () => {\n    'use strict';\n\n    document.removeEventListener('click', handleClick);\n    document.addEventListener('click', handleClick);\n\n    document.querySelector('body').removeEventListener('venueclosed', cleanupVenue);\n    document.querySelector('body').addEventListener('venueclosed', cleanupVenue);\n};\n"],"names":["_interopRequireDefault","e","__esModule","default","_ajax","_config","_fragment","_modal_events","_modal_factory","_notification","_templates","venue","handleClick","button","target","closest","task","getAttribute","url","URL","Config","wwwroot","searchParams","set","Ajax","call","args","mute","status","fail","Notification","exception","methodname","contextid","document","querySelectorAll","forEach","container","innerHTML","ModalFactory","create","large","type","types","SAVE_CANCEL","title","getString","body","then","modal","root","getRoot","setSaveButtonText","setButtonText","get_string","querySelector","classList","add","on","ModalEvents","cancel","show","Fragment","loadFragment","taskid","done","html","js","Templates","replaceNodeContents","remove","window","open","stopPropagation","preventDefault","activeElement","blur","cleanupVenue","destroy","_exports","init","removeEventListener","addEventListener"],"mappings":"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"}