define("block_deft/venue",["exports","core/ajax","core/config","core/fragment","core/str","core/modal_events","core/modal_factory","core/notification","core/templates"],(function(_exports,_ajax,_config,_fragment,_str,_modal_events,_modal_factory,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * Handle events for venue task
   *
   * @package    block_deft
   * @module     block_deft/venue
   * @copyright  2022 Daniel Thies <dethies@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_config=_interopRequireDefault(_config),_fragment=_interopRequireDefault(_fragment),_modal_events=_interopRequireDefault(_modal_events),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);let venue=null;const handleClick=e=>{let button=e.target.closest(".block_deft_venue button[data-action]");if(button){let task=button.closest("[data-task]").getAttribute("data-task"),url=new URL(_config.default.wwwroot+"/blocks/deft/venue.php");switch(url.searchParams.set("task",task),button.getAttribute("data-action")){case"close":_ajax.default.call([{args:{mute:!1,status:!0},fail:_notification.default.exception,methodname:"block_deft_venue_settings"}]);break;case"join":if("modal"===button.getAttribute("data-type")){const contextid=button.getAttribute("data-contextid");document.querySelectorAll(".venue_manager").forEach((container=>{container.innerHTML=""})),_modal_factory.default.create({large:!0,type:_modal_factory.default.types.SAVE_CANCEL,title:(0,_str.get_string)("venue","block_deft"),body:'<div class="venue_manager"></div>'}).then((function(modal){const root=modal.getRoot();return venue=modal,modal.setSaveButtonText((0,_str.get_string)("hide")),modal.setButtonText("cancel",(0,_str.get_string)("leave","block_deft")),document.querySelector("body").classList.add("block_deft_venue_page"),root.on(_modal_events.default.cancel,(function(){_ajax.default.call([{args:{mute:!1,status:!0},fail:_notification.default.exception,methodname:"block_deft_venue_settings"}]),_templates.default.replaceNodeContents(root[0],"","")})),_fragment.default.loadFragment("block_deft","venue_manager",contextid,{taskid:task}).done(((html,js)=>{_templates.default.replaceNodeContents(root[0].querySelector(".venue_manager"),html,js)})).catch(_notification.default.exception),modal.show(),root.on("venueclosed",(()=>{modal.hide(),_templates.default.replaceNodeContents(root[0],"",""),document.querySelector("body").classList.remove("block_deft_venue_page")})),modal})).fail(_notification.default.exception)}else document.querySelector("body").classList.remove("block_deft_venue_page"),window.open(url,"block_deft_venue","popup,height=400,width=600");break;case"mute":_ajax.default.call([{args:{mute:!0,status:!1},fail:_notification.default.exception,methodname:"block_deft_venue_settings"}]);break;case"show":venue.show();break;case"unmute":_ajax.default.call([{args:{mute:!1,status:!1},fail:_notification.default.exception,methodname:"block_deft_venue_settings"}]);break;default:return}e.stopPropagation(),e.preventDefault(),document.activeElement.blur()}};_exports.init=()=>{document.removeEventListener("click",handleClick),document.addEventListener("click",handleClick)}}));

//# sourceMappingURL=venue.min.js.map