{"version":3,"file":"test.min.js","sources":["../src/test.js"],"sourcesContent":["/*\n * Test the connection with message service\n *\n * @package    block_deft\n * @module     block_deft/test\n * @copyright  2022 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from \"core/ajax\";\nimport Fragment from \"core/fragment\";\nimport Log from \"core/log\";\nimport Notification from \"core/notification\";\nimport Socket from \"block_deft/socket\";\nimport {get_string as getString} from 'core/str';\nimport * as Toast from 'core/toast';\n\nexport default {\n\n    /**\n     * Test connection\n     *\n     * @param {int} contextid Context id of block\n     */\n    init: function(contextid) {\n        Log.debug('Requesting token');\n        Ajax.call([{\n            methodname: 'block_deft_renew_token',\n            args: {contextid: contextid},\n            done: (token) => {\n                const socket = new Socket(contextid, token.token);\n                getString('authorizationreceived', 'block_deft').done((message) => {\n                    Toast.add(message, {'type': 'info'});\n                });\n                socket.subscribe((e) => {\n                    if (e.type === 'message') {\n                        getString('messagereceived', 'block_deft').done((message) => {\n                            Toast.add(message, {'type': 'success'});\n                        });\n                    }\n                });\n\n                setTimeout(() => {\n                    Fragment.loadFragment(\n                        'block_deft',\n                        'test',\n                        contextid,\n                        {}\n                    ).done((message) => {\n                        Toast.add(message, {'type': 'info'});\n                    }).fail(Notification.exception);\n                }, 500);\n            },\n            fail: Notification.exception\n        }]);\n    }\n};\n"],"names":["init","contextid","debug","call","methodname","args","done","token","socket","Socket","message","Toast","add","subscribe","e","type","setTimeout","loadFragment","fail","Notification","exception"],"mappings":";;;;;;;;08BAiBe,CAOXA,KAAM,SAASC,wBACPC,MAAM,kCACLC,KAAK,CAAC,CACPC,WAAY,yBACZC,KAAM,CAACJ,UAAWA,WAClBK,KAAOC,cACGC,OAAS,IAAIC,gBAAOR,UAAWM,MAAMA,2BACjC,wBAAyB,cAAcD,MAAMI,UACnDC,MAAMC,IAAIF,QAAS,MAAS,YAEhCF,OAAOK,WAAWC,IACC,YAAXA,EAAEC,0BACQ,kBAAmB,cAAcT,MAAMI,UAC7CC,MAAMC,IAAIF,QAAS,MAAS,kBAKxCM,YAAW,uBACEC,aACL,aACA,OACAhB,UACA,IACFK,MAAMI,UACJC,MAAMC,IAAIF,QAAS,MAAS,YAC7BQ,KAAKC,sBAAaC,aACtB,MAEPF,KAAMC,sBAAaC"}