{"version":3,"file":"publish.min.js","sources":["../src/publish.js"],"sourcesContent":["/**\n * Manage venue connections\n *\n * @module     block_deft/venue_manager\n * @copyright  2022 Daniel Thies <dethies@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport adapter from \"core/adapter\";\nimport Ajax from \"core/ajax\";\nimport Janus from 'block_deft/janus-gateway';\nimport Log from \"core/log\";\nimport Notification from \"core/notification\";\n\nexport default class Publish {\n\n    /**\n     * Listen for comment actions\n     *\n     * @param {int} contextid Context id of block\n     * @param {array} iceServers ICE server array to configure peers\n     * @param {int} roomid\n     * @param {string} server\n     * @param {int} peerid\n     */\n    constructor(\n        contextid, iceServers, roomid, server, peerid\n    ) {\n        this.contextid = contextid;\n        this.iceServers = iceServers;\n        this.roomid = roomid;\n        this.server = server;\n        this.peerid = peerid;\n\n        window.adapter = adapter;\n\n        this.ptype = 'publish';\n\n        document.querySelector('body').removeEventListener('venueclosed', this.handleClose.bind(this));\n        document.querySelector('body').addEventListener('venueclosed', this.handleClose.bind(this));\n    }\n\n    /**\n     * Start to establish the peer connections\n     */\n    startConnection() {\n\n        // Initialize the library (all console debuggers enabled)\n        Janus.init({\n            debug: \"all\", callback: () => {\n                // Create session.\n                this.janus = new Janus(\n                    {\n                        server: this.server,\n                        iceServers: this.iceServers,\n                        success: () => {\n                            // Attach to video room test plugin\n                            this.janus.attach(\n                                {\n                                    plugin: \"janus.plugin.videoroom\",\n                                    opaqueId: \"videoroom-\" + Janus.randomString(12),\n                                    success: pluginHandle => {\n                                        this.videoroom = pluginHandle;\n                                        this.register(pluginHandle);\n                                    },\n                                    error: function(error) {\n                                        Janus.error(\"  -- Error attaching plugin...\", error);\n                                        Notification.alert('', \"Error attaching plugin... \" + error);\n                                    },\n                                    onlocaltrack: this.onLocalTrack.bind(this),\n                                    onremotetrack: this.onRemoteTrack.bind(this),\n                                    onmessage: this.onMessage.bind(this)\n                                }\n                            );\n                        },\n                        error: (error) => {\n                            this.restart = true;\n                            Log.debug(error);\n                        }\n                    }\n                );\n                document.querySelector('body').addEventListener('venueclosed', this.janus.destroy);\n            }\n        });\n    }\n\n    /**\n     * Register the room\n     *\n     * @param {object} pluginHandle\n     * @return {Promise}\n     */\n    register(pluginHandle) {\n        // Try a registration\n        return Ajax.call([{\n            args: {\n                handle: pluginHandle.getId(),\n                id: Number(this.peerid),\n                plugin: pluginHandle.plugin,\n                room: this.roomid,\n                ptype: this.ptype == 'publish',\n                session: pluginHandle.session.getSessionId()\n            },\n            contextid: this.contextid,\n            fail: Notification.exception,\n            methodname: 'block_deft_join_room'\n        }])[0];\n    }\n\n    onLocalTrack(track, on) {\n        Log.debug(on);\n        return;\n    }\n\n    onRemoteTrack() {\n        return;\n    }\n\n    onAttached(publishers) {\n        Log.debug(publishers);\n    }\n\n    /**\n     * Handle Janus plugin message\n     *\n     * @param {String} msg message\n     * @param {String} jsep negotiation\n     */\n    onMessage(msg, jsep) {\n        Log.debug(msg);\n        Janus.debug(\" ::: Got a message :::\", msg);\n        const event = msg.videoroom;\n        Janus.debug(\"Event: \" + event);\n        switch (event) {\n            case 'joined':\n                // Successfully joined, negotiate WebRTC now\n                if (msg.id) {\n                    Janus.log(\"Successfully joined room \" + msg.room + \" with ID \" + this.peerid);\n                    if (!this.webrtcUp) {\n                        const tracks = [{type: 'data'}];\n                        this.webrtcUp = true;\n                        this.videoInput.then(videoStream => {\n                            if (!videoStream || (this.currentStream === videoStream)) {\n                                return videoStream;\n                            }\n                            this.currentStream = videoStream;\n                            videoStream.getVideoTracks().forEach(track => {\n                                tracks.push({\n                                    type: 'video',\n                                    capture: track,\n                                    recv: false\n                                });\n                            });\n                            this.videoroom.createOffer({\n                                tracks: tracks,\n                                success: (jsep) => {\n                                    Janus.debug(\"Got SDP!\", jsep);\n                                    const publish = {\n                                        request: \"configure\",\n                                        video: true,\n                                        audio: false\n                                    };\n                                    this.videoroom.send({\n                                        message: publish,\n                                        jsep: jsep\n                                    });\n                                },\n                                error: function(error) {\n                                    this.restart = true;\n                                    Janus.error(\"WebRTC error:\", error);\n                                    Notification.alert(\"WebRTC error... \", error.message);\n                                }\n                            });\n                            return videoStream;\n                        }).catch(Notification.exception);\n                    }\n                }\n                break;\n            case 'destroyed':\n                // The room has been destroyed\n                Janus.warn(\"The room has been destroyed!\");\n                Notification.alert('', \"The room has been destroyed\");\n                break;\n            case 'event':\n                if (msg.configured) {\n                    this.videoroom.webrtcStuff.pc.removeEventListener(\n                        'iceconnectionstatechange',\n                        this.publishFeed.bind(this)\n                    );\n                    this.videoroom.webrtcStuff.pc.addEventListener(\n                        'iceconnectionstatechange',\n                        this.publishFeed.bind(this)\n                    );\n                    setTimeout(this.publishFeed.bind(this));\n                } else if (msg.error) {\n                    if (msg.error_code === 485) {\n                        // This is a \"no such room\" error: give a more meaningful description\n                        Notification.alert(\n                            \"<p>Apparently room <code>\" + this.roomid + \"</code> (the one this demo uses as a test room) \" +\n                            \"does not exist...</p><p>Do you have an updated <code>janus.plugin.audiobridge.jcfg</code> \" +\n                            \"configuration file? If not, make sure you copy the details of room <code>\" + this.roomid + \"</code> \" +\n                            \"from that sample in your current configuration file, then restart Janus and try again.\"\n                        );\n                    } else if (msg.error_code === 435) {\n                        Log.debug(msg.error);\n                    } else {\n                        Notification.alert(msg.error_code, msg.error);\n                    }\n                    return;\n                } else {\n                    Log.debug(Object.keys(msg));\n                }\n                break;\n        }\n        if (jsep) {\n            Janus.debug(\"Handling SDP as well...\", jsep);\n            this.videoroom.handleRemoteJsep({jsep: jsep});\n        }\n    }\n\n    /**\n     * Handle click of button\n     *\n     * @param {Event} e\n     * @returns {Bool}\n     */\n    handleClick(e) {\n        const button = e.target.closest(\n            '[data-roomid=\"' + this.roomid + '\"] [data-action=\"publish\"],  [data-roomid=\"'\n                + this.roomid + '\"] [data-action=\"unpublish\"]'\n        );\n        if (button) {\n            const action = button.getAttribute('data-action'),\n                type = button.getAttribute('data-type');\n            e.stopPropagation();\n            e.preventDefault();\n            document.querySelectorAll(\n                '[data-region=\"deft-venue\"] [data-action=\"publish\"],  [data-region=\"deft-venue\"] [data-action=\"unpublish\"]'\n            ).forEach(button => {\n                if ((button.getAttribute('data-action') == action) && (button.getAttribute('data-type') == type)) {\n                    button.classList.add('hidden');\n                } else {\n                    button.classList.remove('hidden');\n                }\n            });\n            switch (action) {\n                case 'publish':\n                    Log.debug(type);\n                    if (type == 'display') {\n                        this.shareDisplay();\n                    } else {\n                        this.shareCamera();\n                    }\n\n                    this.videoInput.then(videoStream => {\n                        const tracks = [];\n                        if (videoStream && (this.currentStream !== videoStream)) {\n                            this.currentStream = videoStream;\n                            videoStream.getVideoTracks().forEach(track => {\n                                tracks.push({\n                                    type: 'video',\n                                    capture: track,\n                                    recv: false\n                                });\n                                this.selectedTrack = track;\n                            });\n                            this.videoroom.createOffer({\n                                tracks: tracks,\n                                success: (jsep) => {\n                                    Janus.debug(\"Got SDP!\", jsep);\n                                    const publish = {\n                                        request: \"configure\",\n                                        video: true,\n                                        audio: false\n                                    };\n                                    this.videoroom.send({\n                                        message: publish,\n                                        jsep: jsep\n                                    });\n                                },\n                                error: function(error) {\n                                    Janus.error(\"WebRTC error:\", error);\n                                    Notification.alert(\"WebRTC error... \", error.message);\n                                }\n                            });\n                        }\n\n                        return videoStream;\n                    }).catch(Notification.exception);\n                    break;\n                case 'unpublish':\n                    if (this.videoInput) {\n                        this.videoInput.then(videoStream => {\n                            if (videoStream) {\n                                videoStream.getVideoTracks().forEach(track => {\n                                    track.stop();\n                                });\n                            }\n                            this.videoInput = null;\n\n                            return videoStream;\n                        }).catch(Notification.exception);\n                    }\n                    this.videoroom.send({\n                        message: {\n                            request: 'unpublish'\n                        }\n                    });\n                    return Ajax.call([{\n                        args: {\n                            id: Number(this.peerid),\n                            publish: false,\n                            room: this.roomid\n                        },\n                        contextid: this.contextid,\n                        fail: Notification.exception,\n                        methodname: 'block_deft_publish_feed'\n                    }])[0];\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * Handle close of windoww\n     */\n    handleClose() {\n        if (this.videoInput) {\n            this.videoInput.then(videoStream => {\n                if (videoStream) {\n                    videoStream.getTracks().forEach(track => {\n                        track.stop();\n                    });\n                }\n                return videoStream;\n            }).catch(Notification.exception);\n        }\n        this.janus.destroy();\n    }\n\n    /**\n     * Set video source to user camera\n     */\n    shareCamera() {\n        const videoInput = this.videoInput;\n\n        this.videoInput = navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: false\n        }).then(videoStream => {\n            if (videoInput) {\n                videoInput.then(videoStream => {\n                    if (videoStream) {\n                        videoStream.getTracks().forEach(track => {\n                            track.stop();\n                        });\n                    }\n                    return videoStream;\n                }).catch(Notification.exception);\n            }\n\n            return videoStream;\n        }).catch((e) => {\n            Log.debug(e);\n\n            return videoInput;\n        });\n    }\n\n    /**\n     * Set video source to display surface\n     */\n    shareDisplay() {\n        const videoInput = this.videoInput || Promise.resolve(null);\n\n        this.videoInput = navigator.mediaDevices.getDisplayMedia({\n            video: true,\n            audio: false\n        }).then(videoStream => {\n            videoInput.then(videoStream => {\n                if (videoStream) {\n                    videoStream.getTracks().forEach(track => {\n                        track.stop();\n                    });\n                }\n                return videoStream;\n            }).catch(Notification.exception);\n\n            videoStream.type = 'display';\n\n            return videoStream;\n        }).catch((e) => {\n            Log.debug(e);\n\n            videoInput.then(videoStream => {\n                document.querySelectorAll(\n                    '[data-region=\"deft-venue\"] [data-action=\"publish\"],  [data-region=\"deft-venue\"] [data-action=\"unpublish\"]'\n                ).forEach(button => {\n                    if (videoStream) {\n                        if (\n                            (button.getAttribute('data-action') == 'unpublish')\n                            || (button.getAttribute('data-type') === 'display')\n                        ) {\n                            button.classList.remove('hidden');\n                        } else {\n                            button.classList.add('hidden');\n                        }\n                    } else {\n                        if (button.getAttribute('data-action') == 'unpublish') {\n                            button.classList.add('hidden');\n                        } else {\n                            button.classList.remove('hidden');\n                        }\n                    }\n                });\n            });\n\n            return videoInput;\n        });\n    }\n\n    /**\n     * Publish current video feed\n     */\n    publishFeed() {\n        if (\n            this.videoroom.webrtcStuff.pc\n            && this.videoroom.webrtcStuff.pc.iceConnectionState == 'connected'\n        ) {\n            setTimeout(() => {\n                this.videoroom.webrtcStuff.pc.getTransceivers().forEach(transceiver => {\n                    const sender = transceiver.sender;\n                    if (\n                        sender.track\n                        && this.selectedTrack\n                        && (sender.track.id == this.selectedTrack.id)\n                    ) {\n                        const message = JSON.stringify({\n                            feed: Number(this.peerid),\n                            mid: transceiver.mid\n                        });\n                        this.videoroom.data({\n                            text: message,\n                            error: Log.debug\n                        });\n                    }\n                });\n                return Ajax.call([{\n                    args: {\n                        id: Number(this.peerid),\n                        room: this.roomid,\n                    },\n                    contextid: this.contextid,\n                    fail: Notification.exception,\n                    methodname: 'block_deft_publish_feed'\n                }])[0];\n            });\n        }\n    }\n\n    /**\n     * Stop video feed\n     */\n    unpublish() {\n        if (this.videoInput) {\n            this.videoroom.send({\n                message: {\n                    request: 'unpublish'\n                }\n            });\n            this.videoInput.then(videoStream => {\n                if (videoStream) {\n                    videoStream.getVideoTracks().forEach(track => {\n                        track.stop();\n                    });\n                }\n\n                return videoStream;\n            }).catch(Notification.exception);\n            this.videoInput = Promise.resolve(null);\n        }\n        document.querySelectorAll(\n            '[data-region=\"deft-venue\"] [data-action=\"publish\"]'\n        ).forEach(button => {\n            button.classList.remove('hidden');\n        });\n        document.querySelectorAll(\n            '[data-region=\"deft-venue\"] [data-action=\"unpublish\"]'\n        ).forEach(button => {\n            button.classList.add('hidden');\n        });\n    }\n}\n"],"names":["constructor","contextid","iceServers","roomid","server","peerid","window","adapter","ptype","document","querySelector","removeEventListener","this","handleClose","bind","addEventListener","startConnection","init","debug","callback","janus","Janus","success","attach","plugin","opaqueId","randomString","pluginHandle","videoroom","register","error","alert","onlocaltrack","onLocalTrack","onremotetrack","onRemoteTrack","onmessage","onMessage","restart","destroy","Ajax","call","args","handle","getId","id","Number","room","session","getSessionId","fail","Notification","exception","methodname","track","on","onAttached","publishers","msg","jsep","event","log","webrtcUp","tracks","type","videoInput","then","videoStream","currentStream","getVideoTracks","forEach","push","capture","recv","createOffer","send","message","request","video","audio","catch","warn","configured","webrtcStuff","pc","publishFeed","setTimeout","error_code","Object","keys","handleRemoteJsep","handleClick","e","button","target","closest","action","getAttribute","stopPropagation","preventDefault","querySelectorAll","classList","add","remove","shareDisplay","shareCamera","selectedTrack","stop","publish","getTracks","navigator","mediaDevices","getUserMedia","Promise","resolve","getDisplayMedia","iceConnectionState","getTransceivers","transceiver","sender","JSON","stringify","feed","mid","data","text","Log","unpublish"],"mappings":"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"}